<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<div id="show" >
</div>










  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Zero, Welcom!" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="走过山山水水,脚下高高低低,人生难得糊涂！">
<meta property="og:type" content="website">
<meta property="og:title" content="Zero">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="Zero">
<meta property="og:description" content="走过山山水水,脚下高高低低,人生难得糊涂！">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zero">
<meta name="twitter:description" content="走过山山水水,脚下高高低低,人生难得糊涂！">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/5/"/>





  <title> Zero </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Zero</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/30/写点前端/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Zero">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Zero">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Zero" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/30/写点前端/" itemprop="url">
                  写点前端
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-30T17:18:58+08:00">
                2017-03-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/30/写点前端/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/30/写点前端/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/03/30/写点前端/" class="leancloud_visitors" data-flag-title="写点前端">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>jquery中的ajax方法参数总是记不住，这里记录一下。</p>
<h3 id="url"><a href="#url" class="headerlink" title="url"></a>url</h3><p>要求为String类型的参数,(默认为当前页地址)发送请求的地址。</p>
<h3 id="type"><a href="#type" class="headerlink" title="type"></a>type</h3><p>要求为String类型的参数,请求方式（post或get）默认为get。注意其他http请求方法，例如put和delete也可以使用，但仅部分浏览器支持。</p>
<h3 id="timeout"><a href="#timeout" class="headerlink" title="timeout:"></a>timeout:</h3><p>要求为Number类型的参数,设置请求超时时间(毫秒)。此设置将覆盖$.ajaxSetup()方法的全局设置。</p>
<h3 id="async"><a href="#async" class="headerlink" title="async:"></a>async:</h3><p>要求为Boolean类型的参数，默认设置为true，所有请求均为异步请求。如果需要发送同步请求，请将此选项设置为false。注意，同步请求将锁住浏览器，<br>用户其他操作必须等待请求完成才可以执行。</p>
<h3 id="cache"><a href="#cache" class="headerlink" title="cache:"></a>cache:</h3><p>要求为Boolean类型的参数，默认为true（当dataType为script时，默认为false），设置为false将不会从浏览器缓存中加载请求信息。</p>
<h3 id="data"><a href="#data" class="headerlink" title="data:"></a>data:</h3><p>要求为Object或String类型的参数，发送到服务器的数据。如果已经不是字符串，将自动转换为字符串格式。<br>get请求中将附加在url后。防止这种自动转换，可以查看processData选项。对象必须为key/value格式，<br>例如{foo1:”bar1”,foo2:”bar2”}转换为&amp;foo1=bar1&amp;foo2=bar2。如果是数组，JQuery将自动为不同值对应同一个名称。<br>例如{foo:[“bar1”,”bar2”]}转换为&amp;foo=bar1&amp;foo=bar2。</p>
<h3 id="dataType"><a href="#dataType" class="headerlink" title="dataType"></a>dataType</h3><p>要求为String类型的参数，预期服务器返回的数据类型。如果不指定，JQuery将自动根据http包mime信息返回responseXML或responseText，并作为回调函数参数传递。可用的类型如下：<br>xml：返回XML文档，可用JQuery处理。<br>html：返回纯文本HTML信息；包含的script标签会在插入DOM时执行。<br>script：返回纯文本JavaScript代码。不会自动缓存结果。除非设置了cache参数。注意在远程请求时（不在同一个域下），所有post请求都将转为get请求。<br>json：返回JSON数据。<br>jsonp：JSONP格式。使用SONP形式调用函数时，例如myurl?callback=?，JQuery将自动替换后一个“?”为正确的函数名，以执行回调函数。<br>text：返回纯文本字符串。</p>
<h3 id="beforeSend"><a href="#beforeSend" class="headerlink" title="beforeSend"></a>beforeSend</h3><p>要求为Function类型的参数，发送请求前可以修改XMLHttpRequest对象的函数，例如添加自定义HTTP头。在beforeSend中如果返回false可以取消本次ajax请求。<br>XMLHttpRequest对象是惟一的参数。            function(XMLHttpRequest){<br>               this;   //调用本次ajax请求时传递的options参数<br>            }</p>
<h3 id="complete"><a href="#complete" class="headerlink" title="complete"></a>complete</h3><p>要求为Function类型的参数，请求完成后调用的回调函数（请求成功或失败时均调用）。参数：XMLHttpRequest对象和一个描述成功请求类型的字符串。<br>          function(XMLHttpRequest, textStatus){<br>             this;    //调用本次ajax请求时传递的options参数<br>          }</p>
<h3 id="success"><a href="#success" class="headerlink" title="success"></a>success</h3><p>要求为Function类型的参数，请求成功后调用的回调函数，有两个参数。<br>         (1)由服务器返回，并根据dataType参数进行处理后的数据。<br>         (2)描述状态的字符串。<br>         function(data, textStatus){<br>            //data可能是xmlDoc、jsonObj、html、text等等<br>            this;  //调用本次ajax请求时传递的options参数<br>         }</p>
<h3 id="error"><a href="#error" class="headerlink" title="error:"></a>error:</h3><p>要求为Function类型的参数，请求失败时被调用的函数。该函数有3个参数，即XMLHttpRequest对象、错误信息、捕获的错误对象(可选)。ajax事件函数如下：<br>       function(XMLHttpRequest, textStatus, errorThrown){<br>          //通常情况下textStatus和errorThrown只有其中一个包含信息<br>          this;   //调用本次ajax请求时传递的options参数<br>       }</p>
<h3 id="contentType"><a href="#contentType" class="headerlink" title="contentType"></a>contentType</h3><p>要求为String类型的参数，当发送信息至服务器时，内容编码类型默认为”application/x-www-form-urlencoded”。该默认值适合大多数应用场合。</p>
<h3 id="dataFilter"><a href="#dataFilter" class="headerlink" title="dataFilter"></a>dataFilter</h3><p>要求为Function类型的参数，给Ajax返回的原始数据进行预处理的函数。提供data和type两个参数。data是Ajax返回的原始数据，type是调用jQuery.ajax时提供的dataType参数。函数返回的值将由jQuery进一步处理。<br>            function(data, type){<br>                //返回处理后的数据<br>                return data;<br>            }</p>
<h3 id="dataFilter-1"><a href="#dataFilter-1" class="headerlink" title="dataFilter"></a>dataFilter</h3><p>要求为Function类型的参数，给Ajax返回的原始数据进行预处理的函数。提供data和type两个参数。data是Ajax返回的原始数据，type是调用jQuery.ajax时提供的dataType参数。函数返回的值将由jQuery进一步处理。<br>            function(data, type){<br>                //返回处理后的数据<br>                return data;<br>            }</p>
<h3 id="global"><a href="#global" class="headerlink" title="global"></a>global</h3><p>要求为Boolean类型的参数，默认为true。表示是否触发全局ajax事件。设置为false将不会触发全局ajax事件，ajaxStart或ajaxStop可用于控制各种ajax事件。</p>
<h3 id="ifModified"><a href="#ifModified" class="headerlink" title="ifModified"></a>ifModified</h3><p>要求为Boolean类型的参数，默认为false。仅在服务器数据改变时获取新数据。服务器数据改变判断的依据是Last-Modified头信息。默认值是false，即忽略头信息。</p>
<h3 id="jsonp"><a href="#jsonp" class="headerlink" title="jsonp"></a>jsonp</h3><p>要求为String类型的参数，在一个jsonp请求中重写回调函数的名字。该值用来替代在”callback=?”这种GET或POST请求中URL参数里的”callback”部分，例如{jsonp:’onJsonPLoad’}会导致将”onJsonPLoad=?”传给服务器。</p>
<h3 id="username"><a href="#username" class="headerlink" title="username"></a>username</h3><p>要求为String类型的参数，用于响应HTTP访问认证请求的用户名。</p>
<h3 id="password"><a href="#password" class="headerlink" title="password"></a>password</h3><p>要求为String类型的参数，用于响应HTTP访问认证请求的密码。</p>
<h3 id="processData"><a href="#processData" class="headerlink" title="processData"></a>processData</h3><p>要求为Boolean类型的参数，默认为true。默认情况下，发送的数据将被转换为对象（从技术角度来讲并非字符串）以配合默认内容类型”application/x-www-form-urlencoded”。如果要发送DOM树信息或者其他不希望转换的信息，请设置为false。</p>
<h3 id="scriptCharset"><a href="#scriptCharset" class="headerlink" title="scriptCharset"></a>scriptCharset</h3><p>要求为String类型的参数，只有当请求时dataType为”jsonp”或者”script”，并且type是GET时才会用于强制修改字符集(charset)。通常在本地和远程的内容编码不同时使用。</p>
<p>案例代码</p>
<p>复制代码<br>$(function(){<br>    $(‘#send’).click(function(){<br>         $.ajax({<br>             type: “GET”,<br>             url: “test.json”,<br>             data: {username:$(“#username”).val(), content:$(“#content”).val()},<br>             dataType: “json”,<br>             success: function(data){<br>                         $(‘#resText’).empty();<br>                         var html = ‘’;<br>                         $.each(data, function(commentIndex, comment){<br>                               comment[‘username’]<br>                               comment[‘content’]<br>                         });<br>                         $(‘#resText’).html(html);<br>                      }<br>         });<br>    });<br>});</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/27/cgroup/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Zero">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Zero">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Zero" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/27/cgroup/" itemprop="url">
                  cgroup
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-27T11:53:40+08:00">
                2017-03-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/cgroup调优/" itemprop="url" rel="index">
                    <span itemprop="name">cgroup调优</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/27/cgroup/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/27/cgroup/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/03/27/cgroup/" class="leancloud_visitors" data-flag-title="cgroup">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="cgroup简介"><a href="#cgroup简介" class="headerlink" title="cgroup简介"></a>cgroup简介</h3><p>cgroup是control group的简称，它为Linux内核提供了一种任务聚集和划分的机制，通过一组参数集合将一些任务组织成一个或多个子系统。</p>
<h3 id="cgroup安装"><a href="#cgroup安装" class="headerlink" title="cgroup安装"></a>cgroup安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install libcgroup</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/21/glusterfs优化思想/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Zero">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Zero">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Zero" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/21/glusterfs优化思想/" itemprop="url">
                  glusterfs优化思想
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-21T11:50:25+08:00">
                2017-03-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/分布式存储/" itemprop="url" rel="index">
                    <span itemprop="name">分布式存储</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/21/glusterfs优化思想/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/21/glusterfs优化思想/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/03/21/glusterfs优化思想/" class="leancloud_visitors" data-flag-title="glusterfs优化思想">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>互联网的触角已融入到生活细节，人们习惯将越来越多的照片、短视频等上传至服务器存储、调用。在互联网(尤其是移动互联网)、物联网、云计算、大数据等高速发展的大背景下，数据呈现爆炸式地增长。“小文件”，特别是海量小文件的存储越来越被人们所需要。<br>业界也有很多文件系统专门针对小文件进行优化的分布式文件系统。例如国外的Facebook专门推出的Haystack，国内淘宝的开源TFS等。针对GlusterFS，作者谈谈如何在Gluster上对海量小文件场景进行优化。<br>问题概述<br>海量小文件，当文件数量达到千万级、亿级、十亿级甚至百亿等，在元数据读写、存储效率等要求越来越高，海量小文件通常是业界的一大难题。<br>通常我们认为文件大小小于1MB的文件为小文件，GlusterFS文件系统他的设计在海量小文件场景有他的优劣，后面将细致分析GlusterFS在这种用户场景下的优劣势，<br>已经如何扬长避短，对小文件进行优化。</p>
<h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><p>衡量存储性能主要用两个关键指标，即IOPS和吞吐量（bandwidth）。IOPS（Input/Output per Second）即每秒读写次数，是随机读写主要需要关注的指标；吞吐量指每秒读写的数据<br>量，是顺序大文件读写主要关注的指标。</p>
<p>一般文件系统对文件的读写操作分成几个阶段，查询（lookup），打开/创建（open/create），读写（read/write），关闭（close）。<br>查询，创建和读写基本上是对磁盘操作，其他操作基本上在内核就OK。而小文件读写，在磁盘表现上基本上是随机读写。</p>
<h3 id="GlusterFS在小文件操作上的优劣势"><a href="#GlusterFS在小文件操作上的优劣势" class="headerlink" title="GlusterFS在小文件操作上的优劣势"></a>GlusterFS在小文件操作上的优劣势</h3><p>主要是针对GlusterFS本身特点分析在小文件操作上的优劣势。<br>GlusterFS在架构设计上，有一个特色就是metadata跟数据在一起，没有集中式的metadata服务。这个跟业界其他分布式存储上有很大的差别。其他分布式存储，<br>像ceph、hdfs等，都是有独立的metadata服务，管理整个集群中的metadata。这个特点造成GlusterFS有自己的优势，也有劣势。</p>
<p>（1） 优势<br>·在查找工作时候，在server端会有entry（关于最后落盘文件的元数据和分布）的缓存，这样在open操作时候不需要再操作一次磁盘。而metadata分离的文件系统，<br>查询工作是在metadata服务上进行，要实际open或者读写时候，需要额外去读取一次disk查找落盘文件的元数据和分布情况。<br>·由于metadata和数据结合紧密，理论上，scale out更为线性。添加节点，该节点的所有metadata都在那个节点上。</p>
<p>（2） 劣势<br>·在进行目录遍历相关操作时候，由于没有集中式的metadata服务，遍历目录，需要遍历所有brick服务相应的目前取出相关的文件列表。<br>并且，由于Gluster默认会使用readdirp操作（readdirp是对readdir扩展操作，在返回时候，会将文件的相关的metadata同时返回，readdir与readdirp区别类似ls与ls -l），<br>这样每次可以返回的entry数量少，交互次数相应更多，导致ls或者find等遍历操作会变成非常慢（这个问题在gluster brick数量多或者文件数量多时候回比较严重）。<br>·Gluster在每一个brick节点都有隐藏目录.glusterfs，这个目录是含本机所有的一般文件的硬链接，和目录等文件的软连接。使得对于后端文件系统的inode数量翻倍。</p>
<h3 id="优化建议"><a href="#优化建议" class="headerlink" title="优化建议"></a>优化建议</h3><p>从Gluster本身，以及使用方式上来描述如何针对GlusterFS的海量小文件场景进行性能优化。</p>
<h4 id="Gluster方面"><a href="#Gluster方面" class="headerlink" title="Gluster方面"></a>Gluster方面</h4><p>Gluster Feature<br>Gluster在3.7planning中计划实现对小文件的优化Feature.但是，这个是要DHT 4.0实现，这里DHT 4.0在设计实现阶段。需要在gluster v4上实现的Feature。期待Gluster官方实现这个Feature。<br>撤销lookup-unhash<br>Lookup-unhash配置是在dht上生效的，是指在查找时候，如果在hash所在节点上没有找到相应文件的话，去所有节点上查找一遍。<br>撤销这个配置项，通过如下命令：<br>gluster volume set lookup-unhashed off<br>开启write-behind和flush-behind<br>这两个配置可以开启异步写模式，对于io来说，上层不需要等待太多时间。<br>关闭io-cache，readahead等xlator<br>这些xlator主要是为了大文件设计的，在小文件场景上会有一些性能损耗，需要关闭。</p>
<h4 id="Brick数量设置"><a href="#Brick数量设置" class="headerlink" title="Brick数量设置"></a>Brick数量设置</h4><p>这一块对于Gluster来说是很重要的事情。Gluster客户端会跟所有brick进程建立链接，当brick数量多了以后，对于客户端连接上会变慢，需要等所有brick连接回应后采用响应。<br>另外，brick数量太少的话，每个brick数据太多，io延时会相应变长。这里需要平衡一下。笔者没有细测，这里需要有一定测试。</p>
<h4 id="底层文件系统"><a href="#底层文件系统" class="headerlink" title="底层文件系统"></a>底层文件系统</h4><p>底层文件系统推荐使用xfs，这里红帽的测试基本上是基于xfs上测试。另外，xfs的特性更适合小文件系统。<br>另外，如果热数据不多的场景，关闭文件系统的cache，使用cache在海量文件时候，在内存满时候，查找内存是否命中，以及内存的释放上对io性能造成额外的开销。<br>这里，底层文件系统上，可以做一些加速。<br>例如，在明显有热流量的场景下，可以使用flashcache方式，指定合适的策略，对底层文件系统进行加速。</p>
<h4 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h4><p>目录层级设计<br>目录层级每多一级，对于一次文件的Open行为很可能会多查找一次磁盘。但是目录层级太少，会导致一个目录底下过多的文件，使得同一个目录下面查找相应文件的时间变长。<br>这里建议使用256*256方式，即在底下ab/cd/file。其中ab和cd是指两个两位16进制的数。<br>这里可以在创建好volume以后预先创建好目录结构。<br>另外，在这种情况下，如果要改代码，可以在brick进程即（glusterfsd）上缓存这个目录结构的信息，使得对这个目录结构的查找时候不需要对硬盘过多的操作。</p>
<h4 id="不使用遍历操作"><a href="#不使用遍历操作" class="headerlink" title="不使用遍历操作"></a>不使用遍历操作</h4><p>理由前文已经说过，对于gluster目前版本的架构来说ls这种遍历操作会对整个文件系统造成很大的开销，以及本身性能很慢。看社区的planning，可以期待在4.0版本上这个有所改善。但是目前情况上还是避免这类型操作。</p>
<h4 id="小文件聚合"><a href="#小文件聚合" class="headerlink" title="小文件聚合"></a>小文件聚合</h4><p>存储业界对于海量小文件性能调优上，还是将小文件聚合这种方案更为有效。这里需要注意几个限制：这里小文件聚合后上层需要记录好聚合后所在的file和offset等信息，以及这里小文件聚合场景中文件是一次写，后面不做变更，要不然实现起来会有很多劣势。<br>由于gluster尚未实现这种Feature，需要上层应用来实现，或者自己修改gluster代码。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>少brick；<br>少目录结构；<br>少进行find这种操作，进行key/value操作规避小文件过多；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cluster.lookup-unhashed: off</div><div class="line">performance.io-thread-count: 24</div><div class="line">auth.allow:10.10.10.10</div><div class="line">transport.address-family: inet</div><div class="line">performance.readdir-ahead: on</div><div class="line">nfs.disable: on</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/20/glusterfs中继器调优/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Zero">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Zero">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Zero" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/20/glusterfs中继器调优/" itemprop="url">
                  glusterfs中继器调优
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-20T14:45:42+08:00">
                2017-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/分布式存储/" itemprop="url" rel="index">
                    <span itemprop="name">分布式存储</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/20/glusterfs中继器调优/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/20/glusterfs中继器调优/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/03/20/glusterfs中继器调优/" class="leancloud_visitors" data-flag-title="glusterfs中继器调优">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="write-behind（默认on）"><a href="#write-behind（默认on）" class="headerlink" title="write-behind（默认on）"></a>write-behind（默认on）</h3><p>luster volume set test write-behind on</p>
<p>Write Behind Translator （后写）<br>通常情况下，写操作会比读要慢。通过使用”aggregated background write”技术，write-behind translator 相当显著地改善了写的性能。更确切地说，<br>大量小的写操作被集中起来，形成少量的、大一些的写操作，并且进行后台写处理(non-blocking)。后写方式在client端上聚合了写操作，减小了必须传递的网络包数量。<br>在server端，它帮助服务器优化写的磁盘寻道时间。</p>
<p>aggregate-size<br>该选项决定了在汇聚写操作之前块的大小。参照你的连接速度、RAM的大小，以及工作负载情况，你可以调整这个值。默认的，该值为128KB，能够比较好的满足大多数应用情况。<br>无限制的增加和减小这个值可能会带来性能上的降低。你可以逐渐调整和分析，慢慢找出一个最优化的结果。</p>
<p>flush-behind<br>该选项可以直接通过命令 gluster volume set test flush-behind 的形式进行设置，但实际上，该参数是write-behind的一个选项，<br>如果write-behind为off，只设置flush-behind应该是没有意义的。该选项也同样是为了提升处理大量小文件的性能。<br>在这个选项里close()/flush()能够被堆到后台，允许客户端去处理下一个请求。默认值是on。</p>
<p>注意:<br>通常情况下，protocol translator对于一个请求或者转发的数据包有一个4MB的上限。因此，如果你在client端用了上面的write-behind(大多数会如此)，<br>并且aggregate-size大于4MB，他也不会发出大的数据包。</p>
<h3 id="read-ahead（默认on）"><a href="#read-ahead（默认on）" class="headerlink" title="read-ahead（默认on）"></a>read-ahead（默认on）</h3><p>gluster volume set test read-ahead on<br>Read Ahead Translator （预读）<br>基于预设值，read-ahead会顺序地预取一些块。当你的应用忙于处理一些数据的时候，GlusterFS能够预读下一批等待处理的数据。<br>这样能够使得读取操作更加流畅和迅速。而且，工作起来像一个读的集合器一样（read-aggregator），也就是说，将大量的、零散的读取操作集合成少量的、<br>大一些的读操作，这样，减小了网络和磁盘的负载。page-size 描述了块的大小。page-count 描述了预读块的总数量。</p>
<p>注意:<br>这个translator比较适合于应用在IB-verbs transport环境里。在百兆和千兆以太网接口、没有read-ahead的环境下，能够达到这种连接的最高速度。</p>
<p>gluster volume set test quick-read on</p>
<p>从描述上看，该选项只对fuse有用，同时，如果文件的大小大于默认的64k，则该选项也不起作用。<br>Translator performance/quick-read</p>
<p>该中继器用来提高小文件读性能。<br>通过网络对文件系统进行操作开销很大，因此，quick-read使用glusterfs内部get接口来一次执行多个posix系统调用open/read/close，一次get调用包含：一个open调用 + 多个read调用 + 一个close调用。<br>This translator improves performance of read on small files. Over a posix interface, files are read using the apis open, read and close. For a filesystem implemented over a network, the round trip overhead of these calls can be significant. Hence quick-read uses the glusterfs internal get interface to implement posix abstraction of using open/read/close for reading of files there by reducing the number of calls over network from n to 1 where n = no of read calls + 1 (open) + 1 (close).<br>Example:<br>volume quick-read<br>  type performance/quick-read<br>  option cache-timeout nsecs (1 second)<br>  option max-file-size nbytes (64Kb)<br>  subvolumes client<br>end-volume</p>
<p>cache-timeout<br>缓存失效验证时间，默认值1秒。<br>Timeout for validation of cached file. On timeout stats of the file is compared with that of cached copy. If the file is found to be changed after it is cached, the cache is flushed. The default timeout value is 1 second.<br>max-file-size</p>
<p>可以使用get接口读取的文件最大值，默认值是64KB。当文件大于该值，则使用标准的open/read/close调用。</p>
<p>Maximum size of the file that can be fetched using get interface. Files bigger than this are read using the normal open/read/close. Note that this option controls only how quick-read behaves. Irrespective of the value this option, the applications running on glusterfs continue to use the normal open/read/close interface. Default value of this option is 64 kilo bytes.</p>
<p>glusterfs3.4把quick-read（3.3就这一个translaotr）分解为open-behind和quick-read。原来设计不管操作文件的目的是什么，都要获取真正的fd。重构后，可以根据文件操作目的，如果是修改文件内容，就在后台打开文件并进行操作。如果仅仅是fstat等类似操作，就利用匿名fd来进行，不会等待真正的fd。这样根据操作目的，优化了性能。在lookup时，根据需要设置xdata key，在posix translator层就抓取文件内容。read操作执行到quick-read层时就返回文件内容。</p>
<h3 id="open-behind（默认on）"><a href="#open-behind（默认on）" class="headerlink" title="open-behind（默认on）"></a>open-behind（默认on）</h3><p>gluster volume set test open-behind on<br>Perform open in the backend only when a necessary FOP arrives (e.g writev on the FD, unlink of the file). When option is disabled, perform backend open right after unwinding open().</p>
<h3 id="stat-prefetch（默认on）"><a href="#stat-prefetch（默认on）" class="headerlink" title="stat-prefetch（默认on）"></a>stat-prefetch（默认on）</h3><p>即：performance/md-cache<br>gluster volume set test stat-prefetch on<br>meta-data caching translator in the volume。<br>网上有说法：<br>为规避客户端元数据不一致，把客户端的metadata cache禁用，即配置performance.md-cache-timeout 0。<br>有可能正确，待深入分析，暂用默认值。</p>
<p>force-readdirp参数：<br>Convert all readdir requests to readdirplus to collect stat info on each entry.</p>
<h3 id="io-threads（默认on，16线程）"><a href="#io-threads（默认on，16线程）" class="headerlink" title="io-threads（默认on，16线程）"></a>io-threads（默认on，16线程）</h3><p>gluster volume set test io-thread-count 16</p>
<p>IO线程中继(performance/io-threads）属于性能调整中继的一种，作用是增加IO的并发线程，以提高IO性能。<br>IO线程中继试图增加服务器后台进程对文件元数据读写I/O的处理能力。由于GlusterFS服务是单线程的，使用IO线程转换器可以较大的提高性能。这个转换器最好是被用于服务器端，而且是在服务器协议转换器后面被加载。<br>IO线程操作会将读和写操作分成不同的线程。同一时刻存在的总线程是恒定的并且是可以配置的。</p>
<p>之前GlusterFS Translators v1.3手册对io-threads描述，和当前实现相比可能有出入：<br>AIO增加了异步（后台）读写的功能。通过加载这个translator，你可以利用server的空闲时间去处理新的任务。当server在 DMA方式处理读或者写操作的时候，CPU、内存或者网络并没有被使用。这个translator可以将资源更好的利用起来去处理和增加当前的I/O性能。<br>注意:</p>
<ol>
<li>io-threads translator 只有在unify之上或者在Server protocol之下才会有效果。如果在unify和namespace brick之间，因为没有文件io的处理，所以不会有效果。</li>
<li>‘thread-count’小于或等于你的CPU数量。</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/20/glusterfs中继器/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Zero">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Zero">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Zero" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/20/glusterfs中继器/" itemprop="url">
                  glusterfs中继器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-20T14:30:49+08:00">
                2017-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/分布式存储/" itemprop="url" rel="index">
                    <span itemprop="name">分布式存储</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/20/glusterfs中继器/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/20/glusterfs中继器/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/03/20/glusterfs中继器/" class="leancloud_visitors" data-flag-title="glusterfs中继器">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="性能相关中继器"><a href="#性能相关中继器" class="headerlink" title="性能相关中继器"></a>性能相关中继器</h3><p>write-behind, read-ahead, io-cache, quick-read, open-behind, stat-prefetch(md-cache), io-threads(默认server端)<br>以上中继器默认全部开启，symlink-cache默认关闭。<br>NFS相关性能优化中继器<br>默认开启：<br>performance.nfs.write-behind<br>默认关闭：<br>performance.nfs.read-ahead<br>performance.nfs.io-cache<br>performance.nfs.quick-read<br>performance.nfs.stat-prefetch<br>performance.nfs.io-threads<br>performance.force-readdirp</p>
<p>默认配置中继<br>在./vols/test/test-fuse.vol（客户端）文件中，默认会配置如下中继器：<br>dht和性能相关的write-behind, read-ahead, io-cache, quick-read, open-behind, stat-prefetch(md-cache).</p>
<p>在./vols/test/test.node1.data-disk3.vol同类（服务器端）文件中，默认会设置如下中继器参数：<br>posix、access-control、locks、io-threads、index、maker</p>
<h3 id="默认配置信息"><a href="#默认配置信息" class="headerlink" title="默认配置信息"></a>默认配置信息</h3><p>默认配置项值<br>cache-size<br>io-cahce：cache-size：默认32MB<br>Size of the read cache<br>quick-read：cache-size：默认128MB<br>Size of the read cache</p>
<p>gluster volume set test cache-size 32MB</p>
<p>该命令导致的cache-size更新包含两个部分，一个是io-cache里对应的cache大小，一个是quick-read里的cache大小。<br>从源代码上看，这两个cache-size对应同一个key，所以会出现一改全改的现象，应该是一个bug。<br>read-ahead：page-count：默认值4<br>key为performance.read-ahead-page-count，可以通过该选项进行设置。<br>gluster volume set test read-ahead-page-count 4<br>Number of pages that will be pre-fetched</p>
<p>write-behind：”cache-size”或者”window-size”：默认值1MB<br>key为performance.write-behind-window-size，可以通过该选项进行设置。</p>
<p>gluster volume set test write-behind-window-size 1MB<br>Size of the write-behind buffer for a single file (inode).</p>
<p>io-threads：thread-count：默认16<br>key：performance.io-thread-count<br>gluster volume set test io-thread-count 16</p>
<p>Number of threads in IO threads translator which perform concurrent IO operations at a given time</p>
<p>该配置保存在/vols/test/test.node1.data-disk3.vol同类文件中。<br>md-cache：md-cache-timeout：默认值1（亦stat-prefetch）<br>gluster volume set test md-cache-timeout 1<br>该操作会更改md-cache中继器md-cache-timeout选项的默认值<br>Time period after which cache has to be refreshed<br>io-cache：cache-timeout：默认值1<br>key：performance.cache-refresh-timeout<br>gluster volume set test cache-refresh-timeout 1<br>cache-timeout：The cached data for a file will be retained till ‘cache-refresh-timeout’ seconds, after which data re-validation is performed.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Zero" />
          <p class="site-author-name" itemprop="name">Zero</p>
          <p class="site-description motion-element" itemprop="description">走过山山水水,脚下高高低低,人生难得糊涂！</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">64</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">45</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.unixhot.com/" title="运维社区" target="_blank">运维社区</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.yfshare.vip" title="Jack Wang Blog" target="_blank">Jack Wang Blog</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.25555579.com/" title="背锅侠" target="_blank">背锅侠</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zero</span>
</div>

<script  language="javascript">
window.onload = function() {
var show = document.getElementById("show");
setInterval(function() {
var time = new Date();
// 程序计时的月从0开始取值后+1
var m = time.getMonth() + 1;
//根据自己博客的创建时间更改数值
var t = "Welcome to Zero's  Blog!"+(time.getFullYear()-2017) + "年" + (m-3) + "月"
+ time.getDate() + "天 " + time.getHours() + "时"
+ time.getMinutes() + "分" + time.getSeconds() + "秒";
   t+="<span id='busuanzi_container_site_pv'>"+
    "本站总访问量"+ "<span id='busuanzi_value_site_pv'></span>"+"次"+
   "</span>"+"<span id='busuanzi_container_site_uv'>"+
  "你是本站的第"+"<span id='busuanzi_value_site_uv'></span>"+"个访客"+
"</span>"
show.innerHTML = t;
}, 1000);
}; 
</script>


<!--

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>




-->
        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"zerosre"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("DoxG0uQxF81TSYnLX2XSmf3s-gzGzoHsz", "Q4wLV6Vdxd4YnCWesJ0qk9cO");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
